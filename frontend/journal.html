<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Journal - Nh·∫≠t k√Ω c·ªßa b·∫°n</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- No need for chat.css here -->
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-book-open"></i> AI Journal</h1>
        <div class="user-info">
            <span id="user-email">ƒêang t·∫£i...</span>
            <!-- Link to Chat Page -->
            <a href="/chat.html" class="button outline"> <!-- Changed button to link -->
                <i class="fas fa-comments"></i> Chat v·ªõi AI
            </a>
            <button id="logout-btn" class="outline">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- Global Notification Area -->
    <div id="notification" class="notification"></div>

    <!-- Main Application Container -->
    <div class="app-container">
        <!-- Journal Layout (Sidebar + Main Content) -->
        <div class="journal-layout">
            <!-- Sidebar -->
            <div class="sidebar">
                 <button id="new-entry-btn" class="primary full-width">
                    <i class="fas fa-plus"></i> B√†i vi·∫øt m·ªõi
                </button>
                <hr>
                <h3>Danh s√°ch b√†i vi·∫øt</h3>
                <div id="entries-list" class="entries-list">
                    <p class="text-center text-muted">ƒêang t·∫£i danh s√°ch...</p>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Entry Viewing Area -->
                 <div id="entry-view" class="entry-view hidden">
                     <div class="entry-header">
                         <h2 id="entry-title"></h2>
                         <div class="entry-actions">
                             <button id="edit-entry-btn" class="icon-btn" title="Ch·ªânh s·ª≠a b√†i vi·∫øt"><i class="fas fa-edit"></i></button>
                             <button id="delete-entry-btn" class="icon-btn danger" title="X√≥a b√†i vi·∫øt"><i class="fas fa-trash-alt"></i></button>
                         </div>
                    </div>
                    <div id="entry-date" class="date"></div>
                    <div id="entry-content" class="content"></div>
                    <hr>
                    <button id="get-ai-btn" class="primary"><i class="fas fa-robot"></i>AI</button>
                     <!-- AI Consultation Area -->
                     <div id="ai-consultation" class="ai-consultation hidden">
                         <h3><i class="fas fa-brain"></i>Some AI Chat ü•π</h3>
                          <div id="ai-loading" class="loading-indicator hidden"><i class="fas fa-spinner fa-spin"></i> ƒêang ph√¢n t√≠ch...</div>
                         <div id="ai-content" class="ai-content"></div>
                     </div>
                </div>

                <!-- Entry Editing/Creating Area -->
                <div id="entry-editor" class="entry-editor hidden">
                    <h2 id="editor-title">T·∫°o b√†i vi·∫øt m·ªõi</h2>
                    <form id="entry-form">
                        <input type="hidden" id="entry-id-input">
                        <div class="form-group"><label for="entry-title-input">Ti√™u ƒë·ªÅ</label><input type="text" id="entry-title-input" required></div>
                        <div class="form-group"><label for="entry-content-input">N·ªôi dung</label><textarea id="entry-content-input" rows="15" required></textarea></div>
                        <div class="form-actions">
                            <button type="submit" class="primary">L∆∞u b√†i vi·∫øt</button>
                            <button type="button" id="cancel-btn" class="outline">H·ªßy b·ªè</button>
                        </div>
                    </form>
                </div>

                <!-- Placeholder -->
                <div id="no-entry-selected" class="placeholder-view">
                     <i class="fas fa-feather-alt"></i>
                     <p>Ch·ªçn m·ªôt b√†i vi·∫øt t·ª´ danh s√°ch ho·∫∑c t·∫°o b√†i vi·∫øt m·ªõi.</p>
                </div>

            </div> <!-- End Main Content -->
        </div> <!-- End Journal Layout -->
    </div> <!-- End App Container -->

    <!-- Import JS Modules -->
    <script type="module">
        import { AuthService } from '/static/js/auth.js';
        import { JournalService } from '/static/js/journal.js';
        import { showNotification } from '/static/js/utils.js';
        // apiService is imported implicitly by JournalService

        const authService = new AuthService();
        const journalService = new JournalService();

        // Initialize Auth first
        if (authService.checkLoginStatusAndSetupUserUI()) {
            // Only initialize Journal service if user is logged in
            journalService.init();
        }

        // Setup global error handler
        window.addEventListener("unhandledrejection", (event) => {
             console.error("Unhandled Promise Rejection:", event.reason);
             const message = event.reason?.detail || event.reason?.message || "L·ªói kh√¥ng mong mu·ªën x·∫£y ra.";
             showNotification(message, true);
        });
        window.addEventListener("error", (event) => {
          console.error("Unhandled error:", event.error);
          const message = event.error?.detail || event.error?.message || "L·ªói kh√¥ng mong mu·ªën x·∫£y ra.";
          showNotification(message, true);
        });
    </script>
</body>
</html>