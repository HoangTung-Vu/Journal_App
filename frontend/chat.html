<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Journal - Chat v·ªõi AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <h1>
            <a href="/journal.html" class="no-decoration">
                <i class="fas fa-book-open"></i> AI Journal
            </a>
        </h1>
        <div class="user-info">
            <span id="user-email">ƒêang t·∫£i...</span>
            <a href="/journal.html" class="button outline">
                <i class="fas fa-book"></i> Nh·∫≠t k√Ω
            </a>
            <button id="logout-btn" class="outline">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- Global Notification Area -->
    <div id="notification" class="notification"></div>

    <!-- Main Chat Container -->
    <div class="app-container">
        <div id="chat-container">
            <div id="chat-messages">
                <!-- Initial welcome message -->
                <div class="message ai">
                    <p>üëã Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI c·ªßa b·∫°n.</p>
                    <p>T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:</p>
                    <ul>
                        <li>Ph√¢n t√≠ch c·∫£m x√∫c v√† t√¢m tr·∫°ng t·ª´ c√°c b√†i vi·∫øt nh·∫≠t k√Ω</li>
                        <li>ƒê∆∞a ra l·ªùi khuy√™n v√† g√≥c nh√¨n m·ªõi</li>
                        <li>Tr·∫£ l·ªùi c√°c c√¢u h·ªèi d·ª±a tr√™n ng·ªØ c·∫£nh t·ª´ nh·∫≠t k√Ω c·ªßa b·∫°n</li>
                    </ul>
                    <p><i>L∆∞u √Ω: T√¥i s·∫Ω s·ª≠ d·ª•ng ng·ªØ c·∫£nh t·ª´ 5 b√†i vi·∫øt g·∫ßn nh·∫•t c·ªßa b·∫°n ƒë·ªÉ t∆∞ v·∫•n t·ªët h∆°n.</i></p>
                </div>
            </div>
            <div id="chat-input-area">
                <textarea 
                    id="chat-input" 
                    placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n (Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)"
                    rows="1"
                ></textarea>
                <button id="send-chat-btn" class="primary" title="G·ª≠i tin nh·∫Øn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <!-- Loading indicator -->
            <div id="chat-loading" class="loading-indicator hidden">
                <i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...
            </div>
        </div>
    </div>

    <!-- Import JS Modules -->
    <script type="module">
        import { AuthService } from '/static/js/auth.js';
        import { ChatService } from '/static/js/chat.js';
        import { showNotification } from '/static/js/utils.js';

        // Initialize services
        const authService = new AuthService();
        const chatService = new ChatService();

        // Initialize Auth first to check login status and load user info
        await authService.initChatPage();

        // Initialize Chat service after ensuring user is logged in
        chatService.init();

        // Setup global error handler
        window.addEventListener("unhandledrejection", (event) => {
            console.error("Unhandled Promise Rejection:", event.reason);
            const message = event.reason?.message || "L·ªói kh√¥ng mong mu·ªën x·∫£y ra.";
            showNotification(message, true);
        });

        window.addEventListener("error", (event) => {
            console.error("Unhandled error:", event.error);
            const message = event.error?.message || "L·ªói kh√¥ng mong mu·ªën x·∫£y ra.";
            showNotification(message, true);
        });
    </script>
</body>
</html> 